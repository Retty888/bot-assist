<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hyperliquid Signal Bot</title>
    <link rel="stylesheet" href="/styles.css" />
    <script
      defer
      src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"
    ></script>
  </head>
  <body data-theme="dark">
    <main>
      <header class="hero">
        <div class="hero-actions">
          <button id="theme-toggle" class="theme-toggle" type="button" aria-label="Toggle color theme">
            <span class="theme-toggle__icon" aria-hidden="true">☀️</span>
            <span class="theme-toggle__label">Light</span>
          </button>
        </div>
        <div>
          <p class="eyebrow">Manual Signal Executor</p>
          <h1>Hyperliquid Signal Bot</h1>
          <p class="lede">
            Paste a trading signal to parse it and forward the normalized order to Hyperliquid.
            Without credentials the bot runs in demo mode with mocked clients.
          </p>
        </div>
        <aside class="runtime-hints">
          <h2>Environment</h2>
          <ul>
            <li><code>HYPERLIQUID_PRIVATE_KEY</code></li>
            <li><code>HYPERLIQUID_TESTNET</code> (default: true)</li>
            <li><code>HYPERLIQUID_SLIPPAGE_BPS</code> (optional)</li>
            <li><code>TRADING_SIGNAL</code> (optional override)</li>
          </ul>
          <h3>Signal Helpers</h3>
          <ul class="syntax">
            <li><code>trailing stop 0.5%</code> &rarr; dynamic stop offset</li>
            <li><code>grid 3 150</code> &rarr; equal ladder spacing (absolute)</li>
            <li><code>trail entry 4 0.25%</code> &rarr; geometric ladder (percent)</li>
          </ul>
        </aside>
      </header>

      <section class="card market" id="market-dashboard">
        <header class="market-header">
          <div>
            <h2>Market dashboard</h2>
            <p>Track mid price, spreads, and contextual volatility before executing.</p>
          </div>
          <div class="market-badges">
            <span id="market-mode-badge" class="badge badge--demo">Demo data</span>
            <span id="market-updated" class="badge badge--muted">—</span>
          </div>
        </header>

        <dl class="market-stats">
          <div>
            <dt>Symbol</dt>
            <dd id="market-symbol">—</dd>
          </div>
          <div>
            <dt>Mid price</dt>
            <dd id="market-mid">—</dd>
          </div>
          <div>
            <dt>Spread</dt>
            <dd id="market-spread">—</dd>
          </div>
          <div>
            <dt>Volatility</dt>
            <dd id="market-volatility">—</dd>
          </div>
          <div>
            <dt>Funding</dt>
            <dd id="market-funding">—</dd>
          </div>
          <div>
            <dt>24h volume</dt>
            <dd id="market-volume">—</dd>
          </div>
        </dl>

        <div class="market-controls">
          <label class="switch">
            <input type="checkbox" id="auto-refresh-toggle" checked />
            <span>Auto refresh</span>
          </label>
          <div class="interval-control">
            <label for="auto-refresh-interval">Interval</label>
            <input
              type="range"
              id="auto-refresh-interval"
              min="5"
              max="60"
              step="5"
              value="20"
              aria-label="Auto refresh interval in seconds"
            />
            <span id="auto-refresh-label">20s</span>
          </div>
          <button type="button" id="refresh-now" class="ghost">Refresh now</button>
        </div>

        <div class="chart-grid">
          <article class="chart-panel snapshot-panel">
            <header class="chart-panel__header">
              <h3>Chart snapshot</h3>
              <p>Request a live capture of the market structure for the current signal.</p>
            </header>
            <div class="snapshot-controls">
              <label>
                <span>Interval</span>
                <select id="snapshot-interval">
                  <option value="15m">15m</option>
                  <option value="1h" selected>1h</option>
                  <option value="4h">4h</option>
                  <option value="1d">1d</option>
                </select>
              </label>
              <label>
                <span>Range</span>
                <select id="snapshot-range">
                  <option value="1d">1 day</option>
                  <option value="5d">5 days</option>
                  <option value="1m">1 month</option>
                </select>
              </label>
              <button type="button" id="snapshot-refresh" class="ghost">Refresh snapshot</button>
            </div>
            <figure class="snapshot-figure">
              <img id="chart-snapshot" alt="Market snapshot" />
              <figcaption id="snapshot-caption">Select a signal to capture its market context.</figcaption>
            </figure>
          </article>

          <article class="chart-panel spotlight-panel">
            <header class="chart-panel__header">
              <h3>Signal spotlight</h3>
              <p>Choose a curated or potential signal and inspect it against the chart snapshot.</p>
            </header>
            <div class="spotlight-body">
              <label class="field-label" for="chart-signal-select">Focused signal</label>
              <select id="chart-signal-select" aria-label="Select signal to preview on the chart"></select>
              <div id="signal-spotlight-details" class="spotlight-details" aria-live="polite"></div>
              <button type="button" id="spotlight-load" class="ghost">Load into editor</button>
            </div>
          </article>
        </div>
      </section>

      <section class="card signal-library" id="signal-library">
        <header class="signal-library__header">
          <div>
            <h2>Signal workspace</h2>
            <p>Review curated playbooks, vet algorithmic ideas, and align open positions with their source signals.</p>
          </div>
          <div class="symbol-switch" role="group" aria-label="Select market symbol">
            <button type="button" class="symbol-chip active" data-symbol="BTC">BTC</button>
            <button type="button" class="symbol-chip" data-symbol="ETH">ETH</button>
          </div>
        </header>
        <div class="signal-library__grid">
          <article class="reference-block">
            <h3>Curated playbook</h3>
            <p class="reference-lede">Tap a setup to load it into the editor or spotlight it on the chart.</p>
            <div id="sample-signal-list" class="pill-list" role="list"></div>
          </article>
          <article class="reference-block">
            <h3>Potential signals</h3>
            <p class="reference-lede">Ideas captured manually or surfaced by algorithms awaiting validation.</p>
            <div id="potential-signal-list" class="card-list" role="list"></div>
          </article>
          <article class="reference-block reference-block--wide">
            <h3>Positions & signal alignment</h3>
            <p class="reference-lede">Manage saved positions and link them back to their originating signals.</p>
            <div class="position-controls">
              <label class="field-label" for="position-select">Saved positions</label>
              <div class="position-select-row">
                <select id="position-select" aria-label="Select saved position"></select>
                <button type="button" id="position-new" class="ghost">New</button>
                <button type="button" id="position-refresh" class="ghost">Refresh</button>
                <button type="button" id="position-delete" class="ghost danger">Delete</button>
              </div>
            </div>

            <form id="position-form" class="position-form" autocomplete="off">
              <div class="form-grid">
                <label>
                  <span>Symbol</span>
                  <input type="text" id="position-symbol" name="symbol" required maxlength="12" />
                </label>
                <label>
                  <span>Side</span>
                  <select id="position-side" name="side">
                    <option value="long">Long</option>
                    <option value="short">Short</option>
                  </select>
                </label>
                <label>
                  <span>Size</span>
                  <input type="number" id="position-size" name="size" step="0.001" min="0" required />
                </label>
                <label>
                  <span>Entry price</span>
                  <input type="number" id="position-entry" name="entryPrice" step="0.01" min="0" required />
                </label>
                <label>
                  <span>Stop loss</span>
                  <input type="number" id="position-stop" name="stopLoss" step="0.01" min="0" />
                </label>
                <label>
                  <span>Take profit</span>
                  <input type="number" id="position-tp" name="takeProfit" step="0.01" min="0" />
                </label>
                <label class="span-2">
                  <span>Tags (comma separated)</span>
                  <input type="text" id="position-tags" name="tags" />
                </label>
                <label class="span-2">
                  <span>Notes</span>
                  <textarea id="position-notes" name="notes" rows="2"></textarea>
                </label>
              </div>
              <div class="position-form-footer">
                <div class="position-metrics">
                  <span id="position-notional">Notional: —</span>
                  <span id="position-risk">Risk per % move: —</span>
                </div>
                <button type="submit" class="primary">Save position</button>
              </div>
            </form>

            <table class="position-table" aria-live="polite">
              <thead>
                <tr>
                  <th scope="col">Symbol</th>
                  <th scope="col">Side</th>
                  <th scope="col">Size</th>
                  <th scope="col">Entry</th>
                  <th scope="col">P&L</th>
                </tr>
              </thead>
              <tbody id="demo-position-rows"></tbody>
            </table>
          </article>
        </div>
      </section>

      <section class="card signal-execution" id="signal-execution">
        <header class="signal-execution__header">
          <h2>Signal builder &amp; execution</h2>
          <p>Drop raw text from signal groups, tweak automation modules, and dispatch trades.</p>
        </header>
        <div class="signal-execution__grid">
          <form id="signal-form" class="signal-editor" autocomplete="off">
            <label class="field-label" for="signal">Signal intake</label>
            <textarea
              id="signal"
              name="signal"
              placeholder="Paste signal text or build it manually..."
              spellcheck="false"
            ></textarea>
            <p class="field-hint">Supports copy/paste from Telegram, Discord, and email signal groups.</p>
            <div class="hint-slot" data-hint-slot="signal" aria-live="polite"></div>

            <div class="actions">
              <button type="submit" class="primary">Execute Signal</button>
              <button type="button" id="btn-reset" class="ghost">Reset</button>
              <button type="button" id="btn-sample" class="ghost">Load sample</button>
            </div>
          </form>

          <aside class="advanced" aria-labelledby="advanced-title">
            <div class="advanced-header">
              <h2 id="advanced-title">Automation modules</h2>
              <p>Keep trailing stops, grid entries, and other execution helpers close to the builder.</p>
            </div>

            <div class="toggle-grid">
              <button type="button" class="toggle" data-feature="trailingStop">Trailing Stop</button>
              <button type="button" class="toggle" data-feature="grid">Grid Entries</button>
              <button type="button" class="toggle" data-feature="trailEntry">Trailing Entries</button>
            </div>

            <div id="settings-trailingStop" class="feature-settings hidden">
              <div class="settings-header">
                <div>
                  <h3>Trailing Stop</h3>
                  <p>Offsets the stop relative to the best filled entry.</p>
                </div>
              </div>
              <div class="field-row">
                <label for="trailing-stop-value">Offset</label>
                <div class="input-group">
                  <input type="number" id="trailing-stop-value" min="0.01" step="0.01" value="0.5" />
                  <select id="trailing-stop-unit">
                    <option value="percent">% (percent)</option>
                    <option value="absolute">Absolute</option>
                    <option value="bps">bps</option>
                  </select>
                </div>
              </div>
              <div class="hint-slot" data-hint-slot="trailingStop" aria-live="polite"></div>
            </div>

            <div id="settings-grid" class="feature-settings hidden">
              <div class="settings-header">
                <div>
                  <h3>Grid Entries</h3>
                  <p>Splits the position across evenly spaced limit orders.</p>
                </div>
              </div>
              <div class="field-row">
                <label for="grid-levels">Levels</label>
                <input type="number" id="grid-levels" min="1" max="12" step="1" value="3" />
              </div>
              <div class="field-row">
                <label for="grid-spacing-value">Spacing</label>
                <div class="input-group">
                  <input type="number" id="grid-spacing-value" min="0.01" step="0.01" value="150" />
                  <select id="grid-spacing-unit">
                    <option value="absolute">Absolute</option>
                    <option value="percent">% (percent)</option>
                    <option value="bps">bps</option>
                  </select>
                </div>
              </div>
              <div class="hint-slot" data-hint-slot="grid" aria-live="polite"></div>
            </div>

            <div id="settings-trailEntry" class="feature-settings hidden">
              <div class="settings-header">
                <div>
                  <h3>Trailing Entries</h3>
                  <p>Builds a geometric ladder to chase price with increasing offsets.</p>
                </div>
              </div>
              <div class="field-row">
                <label for="trail-entry-levels">Levels</label>
                <input type="number" id="trail-entry-levels" min="1" max="12" step="1" value="4" />
              </div>
              <div class="field-row">
                <label for="trail-entry-step-value">Step</label>
                <div class="input-group">
                  <input type="number" id="trail-entry-step-value" min="0.01" step="0.01" value="0.25" />
                  <select id="trail-entry-step-unit">
                    <option value="percent">% (percent)</option>
                    <option value="absolute">Absolute</option>
                    <option value="bps">bps</option>
                  </select>
                </div>
              </div>
              <div class="hint-slot" data-hint-slot="trailEntry" aria-live="polite"></div>
            </div>

            <div class="snippet-preview">
              <span>Auto append:</span>
              <code id="auto-snippet">(none)</code>
            </div>
            <p id="auto-error" class="snippet-error"></p>
          </aside>
        </div>
      </section>

      <section class="card hints" id="hints-card">
        <header class="hints-header">
          <h2>Strategy recommendations</h2>
          <span class="hint-badge mild" data-tooltip="Contextual tips update as you tweak the signal.">beta</span>
        </header>
        <div class="hint-context-grid" id="hint-context">
          <div>
            <span class="hint-label">Symbol</span>
            <span class="hint-value" id="hint-symbol">—</span>
          </div>
          <div>
            <span class="hint-label">Price</span>
            <span class="hint-value" id="hint-price">—</span>
          </div>
          <div>
            <span class="hint-label">ATR%</span>
            <span class="hint-value" id="hint-atr">—</span>
          </div>
          <div>
            <span class="hint-label">Volatility</span>
            <span class="hint-value" id="hint-volatility">—</span>
          </div>
          <div>
            <span class="hint-label">Size</span>
            <span class="hint-value" id="hint-size">—</span>
          </div>
          <div>
            <span class="hint-label">Notional</span>
            <span class="hint-value" id="hint-notional">—</span>
          </div>
          <div>
            <span class="hint-label">Funding</span>
            <span class="hint-value" id="hint-funding">—</span>
          </div>
        </div>
        <p id="hint-status" class="hint-status">Paste a signal to pull insights.</p>
        <div id="hint-summary" class="hint-summary" aria-live="polite"></div>
      </section>

      <section class="card output" id="status-card">
        <div class="status-header">
          <h2>Status</h2>
          <span id="status-mode">Mode: &mdash;</span>
        </div>
        <div id="status-message" class="status-message">Ready when you are.</div>
        <details class="details" open>
          <summary>Parsed signal</summary>
          <pre id="parsed-signal">(waiting)</pre>
        </details>
        <details class="details">
          <summary>Order payload</summary>
          <pre id="order-payload">(waiting)</pre>
        </details>
        <details class="details">
          <summary>Exchange response</summary>
          <pre id="exchange-response">(waiting)</pre>
        </details>
      </section>

      <section class="card history" id="history-card">
        <header class="history-header">
          <h2>Open signals &amp; trackers</h2>
          <button type="button" id="history-clear" class="ghost">Clear log</button>
        </header>
        <p id="history-empty" class="history-empty">No tracked signals yet — execute or import one to begin tracking.</p>
        <ol id="history-list" class="history-list" aria-live="polite"></ol>
      </section>

      <footer class="footer">
        <p>
          HTTP API: <code>POST /api/execute</code>
          <small>Body: <code>{ "text": string }</code></small>
        </p>
        <p>
          Default signal endpoint: <code>GET /api/default-signal</code>
        </p>
      </footer>
    </main>

    <script type="module" src="/app.js"></script>
  </body>
</html>
